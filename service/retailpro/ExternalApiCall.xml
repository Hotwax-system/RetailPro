<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-3.xsd">
    <!-- Service for manual api call -->
    <service verb="get" noun="ManualApiCall">
        <in-parameters>
            <parameter name="payload" type="Map"/>
        </in-parameters>
        <out-parameters>
            <parameter name="message"/>
            <parameter name="statusCode"/>
            <parameter name="shipment"/>
        </out-parameters>
        <actions>
            <set field="url" value="http://201.150.84.11:9009/api/v1/Transfer/Slip"/>
            <script>
                import org.moqui.util.RestClient
                import groovy.json.JsonSlurper
                import groovy.json.JsonOutput
                RestClient restClient = ec.service.rest()

                restClient.method("POST")
                restClient.uri(url)

                restClient.addHeader("Content-Type","application/json");

                restClient.jsonObject(payload)

                try {
                RestClient.RestResponse restResponse = restClient.call()
                statusCode = restResponse.statusCode

                rawJsonMessage = restResponse.text()
                def parsedMessageJson = new JsonSlurper().parseText(rawJsonMessage)
                message = JsonOutput.toJson(parsedMessageJson).replace('"', '\\"')

                shipment = JsonOutput.toJson(payload).replace('"', '\\"')

                } catch (Exception e) {
                ec.logger.error("Error in API call, StatusCode: ${statusCode}, Error: ${e}")
                }
            </script>
        </actions>
    </service>

        <!-- Order to invoice api call -->
    <service verb="get" noun="InvoiceApiCall">
        <in-parameters>
            <parameter name="payload" type="Map"/>
        </in-parameters>
        <out-parameters>
            <parameter name="statusCode"/>
            <parameter name="message"/>
            <parameter name="header"/>
            <parameter name="createdDate"/>
            <parameter name="shipment"/>
        </out-parameters>

        <actions>
            <set field="url" value="http://201.150.84.13:9100/api/v1/Document/OrderToInvoice"/>
            <script>
                import java.time.*
                import java.time.format.DateTimeFormatter
                import org.moqui.util.RestClient
                import groovy.json.JsonSlurper
                import groovy.json.JsonOutput

                RestClient restClient = ec.service.rest()

                restClient.method("POST")
                restClient.uri(url)

                restClient.addHeader("Content-Type","application/json");

                restClient.jsonObject(payload)

                try {
                RestClient.RestResponse restResponse = restClient.call()
                statusCode = restResponse.statusCode
                header = restResponse.headers()

                rawJsonMessage = restResponse.text()
                def parsedMessageJson = new JsonSlurper().parseText(rawJsonMessage)
                message = JsonOutput.toJson(parsedMessageJson).replace('"', '\\"')

                shipment = JsonOutput.toJson(payload).replace('"', '\\"')

                createdDate = ZonedDateTime.now(ZoneOffset.UTC)
                .format(DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm:ss'Z'"))

                } catch (Exception e) {
                ec.logger.error("Error in API call, StatusCode: ${statusCode}, Error: ${e}")
                }

            </script>
        </actions>
    </service>

        <!-- solr order indexing api call -->
    <service verb="post" noun="SolrOrderIndex">
        <in-parameters>
            <parameter name="orderPayload"/>
        </in-parameters>

        <actions>
            <set field="url" value="https://localhost:8443/api/service/addDataToSearchIndex"/>
            <script>
                import org.moqui.util.RestClient
                RestClient restClient = ec.service.rest()

                restClient.method("POST")
                restClient.uri(url)

                restClient.addHeader("Content-Type","application/json");
                restClient.jsonObject(orderPayload)

                try {
                RestClient.RestResponse restResponse = restClient.call()
                message = restResponse.text()
                } catch (Exception e) {
                ec.logger.error("Error in API call, StatusCode: ${statusCode}, Error: ${e}")
                }
            </script>
        </actions>
    </service>

</services>